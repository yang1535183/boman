<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.boman.upms.dao.mapper.MealRollMapper">
  <sql id="mealRollColumns">
		a.id AS "id",
		u1.user_id AS "createBy.userId",
		u1.username AS "createBy.username",
		a.create_date AS "createDate",
		u2.user_id AS "update_by.userId",
		u2.username AS "update_by.username",
		a.update_date AS "updateDate",
		a.remarks AS "remarks",
		a.del_flag AS "delFlag",
		a.face_value AS "faceValue",
		a.coop_business AS "coopBusiness",
		a.s_date AS "sDate",
		a.e_date AS "eDate",
		a.c_date AS "cDate",
		a.receive AS "receive",
		u3.user_id AS "receiver.userId",
		u3.username AS "receiver.username"
	</sql>

  <sql id="mealRollJoins">
      left join upms_user u1 on a.create_by = u1.user_id
      left join upms_user u2 on a.update_by = u2.user_id
      left join upms_user u3 on a.receiver = u3.user_id
  </sql>

  <select id="get" resultType="com.boman.upms.dao.model.MealRoll">
    SELECT
    <include refid="mealRollColumns"/>
    FROM meal_roll a
    <include refid="mealRollJoins"/>
    WHERE a.id = #{id}
  </select>

  <select id="findList" resultType="com.boman.upms.dao.model.MealRoll">
    SELECT
    <include refid="mealRollColumns"/>
    FROM meal_roll a
    <include refid="mealRollJoins"/>
    <where>
      a.del_flag = #{DEL_FLAG_NORMAL}
      <if test="beginCreateDate != null and endCreateDate != null and beginCreateDate != '' and endCreateDate != ''">
        AND a.create_date BETWEEN #{beginCreateDate} AND #{endCreateDate}
      </if>
      <if test="remarks != null and remarks != ''">
        AND a.remarks LIKE
        <if test="dbName == 'oracle'">'%'||#{remarks}||'%'</if>
        <if test="dbName == 'mssql'">'%'+#{remarks}+'%'</if>
        <if test="dbName == 'mysql'">concat('%',#{remarks},'%')</if>
      </if>
      <if test="faceValue != null and faceValue != ''">
        AND a.face_value = #{faceValue}
      </if>
      <if test="sDate != null and sDate != ''">
        AND a.s_date = #{sDate}
      </if>
      <if test="eDate != null and eDate != ''">
        AND a.e_date = #{eDate}
      </if>
      <if test="beginCDate != null and endCDate != null and beginCDate != '' and endCDate != ''">
        AND a.c_date BETWEEN #{beginCDate} AND #{endCDate}
      </if>
      <if test="receive != null and receive != ''">
        AND a.receive = #{receive}
      </if>
    </where>
    <choose>
      <when test="page !=null and page.orderBy != null and page.orderBy != ''">
        ORDER BY ${page.orderBy}
      </when>
      <otherwise>
        ORDER BY a.update_date DESC
      </otherwise>
    </choose>
  </select>

  <select id="findAllList" resultType="com.boman.upms.dao.model.MealRoll">
    SELECT
    <include refid="mealRollColumns"/>
    FROM meal_roll a
    <include refid="mealRollJoins"/>
    <where>
      a.del_flag = #{DEL_FLAG_NORMAL}
    </where>
    <choose>
      <when test="page !=null and page.orderBy != null and page.orderBy != ''">
        ORDER BY ${page.orderBy}
      </when>
      <otherwise>
        ORDER BY a.update_date DESC
      </otherwise>
    </choose>
  </select>

  <update id="update">
		UPDATE meal_roll SET
			update_by = #{updateBy.userId},
			update_date = #{updateDate},
			remarks = #{remarks},
			face_value = #{faceValue},
			coop_business = #{coopBusiness},
			s_date = #{sDate},
			e_date = #{eDate},
			c_date = #{cDate},
			receive = #{receive},
			receiver = #{receiver.userId}
		WHERE id = #{id}
	</update>

  <update id="delete">
		UPDATE meal_roll SET
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
  </update>

  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultType="com.boman.upms.dao.model.MealRoll">
        SELECT
        <include refid="mealRollColumns"/>
        FROM meal_roll a
        <include refid="mealRollJoins"/>
        WHERE a.id = #{id}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 11 17:10:00 CST 2019.
    -->
    delete from meal_roll
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.boman.upms.dao.model.MealRoll">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 11 17:10:00 CST 2019.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    INSERT INTO meal_roll(
          create_by,
          create_date,
          update_by,
          update_date,
          remarks,
          del_flag,
          face_value,
          coop_business,
          s_date,
          e_date,
          c_date,
          receive,
          receiver
          ) VALUES (
          #{createBy.userId},
          #{createDate},
          #{updateBy.userId},
          #{updateDate},
          #{remarks},
          #{delFlag},
          #{faceValue},
          #{coopBusiness},
          #{sDate},
          #{eDate},
          #{cDate},
          #{receive},
          #{receiver.userId}
          )

  </insert>
  <insert id="insertSelective" parameterType="com.boman.upms.dao.model.MealRoll">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 11 17:10:00 CST 2019.
    -->
    insert into meal_roll
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="createBy != null">
        create_by,
      </if>
      <if test="createDate != null">
        create_date,
      </if>
      <if test="delFlag != null">
        del_flag,
      </if>
      <if test="userBy != null">
        user_by,
      </if>
      <if test="userDate != null">
        user_date,
      </if>
      <if test="faceValue != null">
        face_value,
      </if>
      <if test="coopBusiness != null">
        coop_business,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="createBy != null">
        #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null">
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="delFlag != null">
        #{delFlag,jdbcType=CHAR},
      </if>
      <if test="userBy != null">
        #{userBy,jdbcType=VARCHAR},
      </if>
      <if test="userDate != null">
        #{userDate,jdbcType=TIMESTAMP},
      </if>
      <if test="faceValue != null">
        #{faceValue,jdbcType=VARCHAR},
      </if>
      <if test="coopBusiness != null">
        #{coopBusiness,jdbcType=VARCHAR},
      </if>
      <if test="isUse != null">
        #{isUse,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.boman.upms.dao.model.MealRoll">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 11 17:10:00 CST 2019.
    -->
    update meal_roll
    <set>
      <if test="createBy != null">
        create_by = #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null">
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="delFlag != null">
        del_flag = #{delFlag,jdbcType=CHAR},
      </if>
      <if test="userBy != null">
        user_by = #{userBy,jdbcType=VARCHAR},
      </if>
      <if test="userDate != null">
        user_date = #{userDate,jdbcType=TIMESTAMP},
      </if>
      <if test="faceValue != null">
        face_value = #{faceValue,jdbcType=VARCHAR},
      </if>
      <if test="coopBusiness != null">
        coop_business = #{coopBusiness,jdbcType=VARCHAR},
      </if>
      <if test="isUse != null">
        is_use = #{isUse,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.boman.upms.dao.model.MealRoll">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Oct 11 17:10:00 CST 2019.
    -->
    UPDATE meal_roll SET
    update_by = #{updateBy.userId},
    update_date = #{updateDate},
    remarks = #{remarks},
    face_value = #{faceValue},
    coop_business = #{coopBusiness},
    s_date = #{sDate},
    e_date = #{eDate},
    c_date = #{cDate},
    receive = #{receive},
    receiver = #{receiver.userId}
    WHERE id = #{id}
  </update>

  <select id="selectByMealRollForOffsetPage" parameterType="com.boman.upms.dao.model.MealRoll" resultType="com.boman.upms.dao.model.MealRoll">
    select
    <include refid="mealRollColumns"/>
    from meal_roll a
    <include refid="mealRollJoins"/>

    <if test="faceValue != null and faceValue != '' ">
      where a.face_value like concat('%', #{faceValue}, '%')
    </if>
    <if test="order != null and sort != null">
      ORDER BY #{sort} #{order}
    </if>
    <if test="order == null and sort == null">
      ORDER BY a.update_date desc,id desc
    </if>
  </select>

  <select id="countByMealRoll" parameterType="com.boman.upms.dao.model.MealRoll" resultType="java.lang.Long">
    select count(*) from meal_roll
    <if test="faceValue != null and faceValue != '' ">
      where face_value like concat('%', #{faceValue}, '%')
    </if>
  </select>
</mapper>